{{ if .Values.networkPolicy.enabled }}
kind: NetworkPolicy
apiVersion: networking.k8s.io/v1
metadata:
  name: egress-fabric-np
  namespace: {{ .Values.namespace.name }}
  labels:
    app: fabric
    {{- range $label := .Values.labels }}
    {{ $label.name }}: {{ $label.value }}
    {{- end }}
spec:
  podSelector:
    matchLabels:
      app: fabric
  policyTypes:
  - Egress
  egress:
  - to:
    - podSelector:
        matchLabels:
          app: cassandra
    ports:
    - port: 9042
    - port: 9142
  - to:
    - podSelector:
        matchLabels:
          app: postgres
    ports:
    - port: 5432
  - to:
    ports:
      - port: 53
        protocol: TCP
      - port: 53
        protocol: UDP
  - to:
    - podSelector:
        matchLabels:
          app: neo4j
    ports:
    - port: 7687
  - to:
    - podSelector:
        matchLabels:
          app: kafka
    ports:
    - port: 9093
    - port: 9092
    - port: 2181
    - port: 2888
    - port: 3888
{{ end }}